# 프로세스 개요

컴퓨터에 실행된 프로세스를 확인하면 여려 프로세스가 실행 중인 걸 확인 가능
이 중 사용자가 볼 수 없는 공간에서 실행되는 프로세스를 백그라운드 프로세스, 확인 가능한 포그라운드 프로세스로 나뉘어져 있다

백그라운드 프로세스 중 사용자와 직접 상호작용 할 수 없는 서비스를 데모, 서비스라고 한다.

## 프로세스 제어 블록

프로세스는 CPU자원이 필요하지만 이는 한정적 그렇기에 차례대로 돌아가면서 사용하게 됨
시간이 끝났음을 알리는 인터럽트가 발생하면 자신의 차례를 양보하고 다음 차례가 올 때까지 기다린다

운영체제는 빠르게 번갈아 수행되는 프로세스의 실행 순서를 관리하고 프로세스에 CPU를 비롯한 자원을 배분한다. 이를 위해 운영체제는 프로세스 제어 블록 PCB을 이용함
프로세스 제어 블록은 프로세스와 관련된 정보를 저장하는 자료 구조
PCB는 커널 영역에 생성됨

PCB에 담긴 정보

### 프로세스 ID

특정 프로세스를 식별하기 위해 부여하는 고유한 번호

### 레지스터 값

자신의 실행 차례가 돌아오면 이전까지 사용했던 레지스터의 중간값을 모두 복원한다
그래서 PCB 안에 해당 프로세스가 실행하며 사용했던 프로그램 카운터를 비롯한 레지스터 값들이 담김

### 프로세스 상태

현재 프로세스가 어떤 상태인지 PCB에 기록되어야 함

### CPU 스케줄링 정보

프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보도 기록되어 있음

### 메모리 관리 정보

PCB에 프로세스가 어느 주소에 저장되어 있는지에 대한 정보가 담겨 있어야 함
PCB에는 베이스 레지스터, 한계 레지스터 값과 같은 정보들이 담겨 있음

### 사용한 파일과 입출력 장치 목록

프로세스가 실행과정에서 특정 입출력 장치나 파일을 사용하면 PCB에 해당 내용이 명시됨
어떤 입출력 장치가 프로세스에 할당되었는지, 어떤 파일들을 열었는지에 대한 정보들이 PCB에 기록됨

## 문맥 교환

프로세스 수행을 재개하기 위해 기억해야 할 정보를 문맥이라고함
기존 프로세스의 문맥을 PCB에 백업하고 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구하여 새로운 프로세스를 실행하는 것을 문맥 교환이라고 한다

## 프로세스 메모리 영역

### 코드 영역

실행할 수 있는 코드가 저장됨

### 데이터 영역

잠깐 썻다가 없앨 데이터가 아닌 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간

### 힙 여역

프로그래머가 직접 할당할 수 있느 ㄴ저장공안

## 스택 영역

데이터를 일시적으로 저장하는 공간

# 프로세스 상태와 계층 구조

## 프로세스 상태

### 생성 상태

메모리에 막 적재되어 PCB를 할당받은 상태

### 준비 상태

당장이라도 CPU를 할당받아 실행할 수 있지만 아직 차례를 기다리는 상태

### 실행 상태

CPU를 할당받아 실행 중인 상태를 의미

### 대기 상태

실행 도중 입출력 장치를 사용하는 경우 작업을 기다리는 상태

### 졸료 상태

프로세스가 종료된 상태

## 프로세스 계층 구조

새 프로세스를 생성한 프로세를 부모 프로세스, 부모에 의해 생성된 프로세스 자식 프로세스

## 프로세스 생성과 최초 프로세스

- **프로세스 생성**

  - 프로세스는 실행 도중에 `fork` 등의 시스템 콜을 통해 새로운 프로세스를 만들 수 있음.
  - 새로운 프로세스를 만든 프로세스를 **부모 프로세스**(Parent Process), 생성된 프로세스를 **자식 프로세스**(Child Process)라고 함.
  - 부모와 자식 프로세스는 각각 별도의 PID를 가짐.
  - 일부 운영체제는 자식 프로세스에 부모 프로세스의 PID(PPID)를 기록하기도 함.

- **최초의 프로세스**
  - 유닉스 계열에서는 `init`, 리눅스에서는 `systemd`, macOS에서는 `launchd`가 처음 시작되는 프로세스임.
  - 이 최초의 프로세스의 PID는 항상 1번임.

## 프로세스 생성 기법

1. **fork**

   - 부모 프로세스의 복사본을 떠서 자식 프로세스로 만드는 시스템 콜.
   - 자식은 부모의 메모리 상태, 열려 있는 파일 등의 자원을 상속받되, PID나 메모리 주소 등은 달라짐.

2. **exec**
   - 이미 생성된 자식 프로세스가, 자신의 메모리 공간을 전혀 다른 프로그램으로 교체하는 시스템 콜.
   - 코드와 데이터 영역이 교체될 뿐 아니라, 나머지 영역도 초기화됨.

## 스레드(Thread)

- **프로세스와 스레드**
  - 스레드는 레지스터 값, 스택, 프로그램 카운터 등의 정보를 독립적으로 가짐으로써 서로 다른 흐름을 동시에 수행할 수 있음.
  - 여러 스레드는 하나의 프로세스 자원을 공유하면서, 레지스터와 스택 등 최소한의 정보만 독립적으로 유지함.
  - 많은 운영체제에서 실제 CPU 스케줄링 단위를 스레드 단위로 취급함.
  - 리눅스 같은 OS는 프로세스와 스레드를 명확히 구분하지 않고 ‘태스크(task)’라는 이름으로 일괄 관리하기도 함.

## 멀티프로세스와 멀티스레드

- **멀티프로세스(Multi-Process)**

  - 독립적인 여러 프로세스를 동시에 실행.
  - 프로세스 간 메모리를 기본적으로 공유하지 않으므로, 한 프로세스에 문제가 생겨도 다른 프로세스에는 직접적 영향을 주지 않음.

- **멀티스레드(Multi-Thread)**
  - 한 프로세스 내부에서 여러 스레드를 동시에 실행.
  - 같은 프로그램을 여러 프로세스로 실행하는 것보다 메모리를 효율적으로 사용할 수 있음.
  - 단, 한 스레드에 문제가 생기면 프로세스 전체가 영향을 받을 수 있으므로 주의가 필요함.

## 프로세스 간 통신(IPC)

- 서로 다른 프로세스가 데이터를 주고받는 여러 방식
- **공유 메모리(Shared Memory)**
  - 프로세스들이 공통으로 접근 가능한 메모리 영역을 두어, 이 영역을 통해 데이터를 주고받음.
- 이외에도 파일, **소켓**, **파이프** 등을 활용한 통신 방법이 존재함.
