# 교착 상태란

## 식사하는 철학자 문제

교착 상태가 어떤 상황에서 발생하고 이런 교착 상태를 어떻게 해결할 수 있는지 엿볼 수 있는 가상의 시나리오<br/>
원탁에 철학자들이 앉아있고 각 철학자들 앞에는 한 개의 식사, 식사 사이엔 한 개의 포크가 놓여 있을 떄, 해당 식사가 두 개의 포크로 먹을 수 있다고 가정함. 각 철학자들은 각 포크가 사용 가능할 때까지 생각을 하다 양 손에 포크가 생기면 식사를 진행하고 한 포크씩 내려 놓는 과정을 반복함.

- 문제점: 모든 철학자가 왼쪽 포크를 집어들면 오른쪽 포크를 영원히 집어들 수 없어 영원히 대기해야함
- 위 문제에서 철학자는 프로세스/스레드, 포크는 자원, 생각하는 행위는 자원 대기를 의미하고 포크는 한 번에 하나의 프로세스/스레드에만 접근 가능하므로 임계 구역이라고 볼 수 있음
- 교착상태: 일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상

<br/><br/>

## 자원 할당 그래프

어떤 프로세스가 어떤 자원을 사용하고 있고, 어떤 프로세스가 어떤 자원을 기다리고 있는지 표현하는 간단한 그래프

### 자원 할당 그래프 규칙

1. 프로세스는 원, 자원은 사각형으로 표현
2. 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현
3. 프로세스가 어떤 자원을 할당 받아 사용중이라면 자원->프로세스 화살표를 표시
4. 프로세스가 어떤 자원을 기다리고 있따면 프로세스->자원 화살표를 표시

- 자원 할당 그래프가 원의 형태를 띄면 교착 상태가 발생

<br/><br/>

## 교착 상태 발생 조건

상호배제, 점유와 대기, 비선점, 원형 대기의 조건을 모두 만족 시 발생할 가능성이 생김

- 상호 배제: 한 자원을 하나의 프로세스만 이용할 수 있음
- 점유와 대기: 자원을 할당 받은 상태에서 다른 자원을 기다리는 상태
- 비선점: 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못함
- 원형 대기: 프로세스들과 프로세스가 요청 및 할당받은 자원이 원의 형태를 이룸

<br/><br/><br/><br/>

# 교착 상태 해결 방법

## 교착 상태 예방

교착 상태 발생 조건 네가지 중 하나라도 만족시키지 못하게 함

- 상호 배제: 상호 배제 제거는 모든 자원 공유 가능하게 하는 것. -> 현실적으로 이는 어려움
- 점유와 대기: 철학자 문제에서 양 쪽 포크를 모두 들거나, 모두 들지 않게 하는 것처럼 한 프로세스에 필요 자원을 몰아줘서 할당 받은 상태로 대기하지 않게 함. -> 자원 활용률 낮아짐. 많은 자원을 사용하는 프로세스가 불리해져 기아 현상 야기할 수 있음
- 비선점: 일정 시간이 지나면 다른 프로세스에 자원을 할당하는 등 자원을 선점할 수 있게 함 -> 모든 자원이 선점 가능하지 않기 때문에(ex. 프린터기는 사용 중에 넘기기 어려움) 범용성이 떨어짐
- 원형 대기: 모든 자원에 번호를 붙이고 오름차순으로 자원을 할당함 -> 자원에 모두 번호를 붙이기 어렵고 어떤 번호를 붙이냐에 따라 자원의 활용률이 떨어질 수 있음

=> 교착 상태가 발생하지 않음을 보장할 순 있지만 부작용이 따름

<br/><br/>

## 교착 상태 회피

교착 상태가 발생하지 않을 정도로만 조심스럽게 자원을 할당하는 방식

- 안전 상태: 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태.
- 불안전 상태: 교착 상태가 발생할 수도 있는 상황. 안전 순서열이 없는 상황.
- 안전 순서열: 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서

<br/><br/>

## 교착 상태 검출 후 회복

교착 상태 발생을 인정하고 사후에 조치하는 방식

- 선점을 통한 회복: 교착 상태가 회복될 때까지 다른 프로세스로부터 자원을 빼앗아 한 프로세스씩 자원을 몰아주는 방식
- 프로세스 강제 종료를 통한 회복: 교착 상태에 놓인 프로세스를 모두 강제 종료하거나, 한 프로세스씩 강제 종료하는 방식.
  - 장점: 가장 확실한 방식
  - 단점: 모두 강제 종료할 경우 많은 프로세스들이 작업 내역을 잃게 될 가능성이 있고 한 프로세스씩 강제 종료할 경우 교착 상태 확인 여부를 확인하는 과정에서 오버헤드를 야기함

<br/><br/>

## 교착 상태 무시

- 타조 알고리즘: 드물게 발생하는 잠재적 문제를 무시로 대처하는 방식
- 문제 발생의 빈도나 심각성에 따라 최대 효율을 추구하면 때론 이 방식이 적합할 때도 많음
