# 교착 상태

일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상

## 자원 할당 그래프

자원 할당 그래프로 교착 상태를 단순하게 표현할 수 있다.
어떤 프로세스가 어떤 자원을 사용하고 있고, 어떤 프로세스가 어떤 자원을 기다리고 있는 지를 표현하는 간단한 그래프

1. 프로세스는 원으로, 자원으로 종류는 사각형으로 표현
2. 사용할 수 있는 자원의 갯수는 자원 사각형 내에 점으로 표현
3. 프로세스가 어떤 자원을 할당받아 사용중이라면 자원에서 프로세스를 향해 화살표 표시
4. 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표를 표시

## 교착 상태 발생 조건

1. 상호 배제(Mutual Exclusion)
   한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때

2. 점유 대기 (Hold and Wait)
   자원을 할당받은 상태에서 다른 자원을 할당 받기를 기다리는 상태

3. 비선점 (No preemption)
   그 자원을 이용하는 프로세스의 작업이 끝나야만 이용가능

4. 원형 대기(Circular wait)
   자원 할당 그래프가 원의 형태로 그려지만 교착 상태가 발생할 수 있음

# 교착 상태 해결 방법

## 교착 상태 예방

교착 상태 필요 조건 네 가지중 하나를 충족 못하게하는 방법

1. 자원의 상호 배제 제거
   모든 자원을 공유 가능하게 만든다 -> 현실적으로 모든 자원의 상호 배제를 없애기에는 어려움

2. 점유 대기 제거
   프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분
   -> 자원의 활용률이 낮아질 우려가 있다, 당장 필요해도 기다려야하는 프로세스와 오랫동안 할당되는 자원을 다수 양산하기 때문
   -> 또한, 많은 자원을 필요로 하는 프로세스는 동시에 자원을 사용할 타이밍을 확보하기가 어렵기에 불리해진다

3. 비선점 조건 제거
   자원을 이용 중인 프로세스로부터 해당 자원을 빼앗을 수 있다
   -> 이 방식은 선점하여 사용할 수 있는 일부 자원에 대해서는 효과적, 하지만 모든 자원이 선점 가능한 것은 아님 (범용성이 떨어짐)

4. 원형 대기 조건
   모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하면 원형 대기는 발생하지 않음
   -> 모든 컴퓨터 시스템 내에 존재하는 수 많은 자원에 번호를 붙이는 작업이 간단하지 않으며, 각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용률이 떨어질 수 있다

예방 방식은 교착 상태 발생 조건을 원천적으로 제거할 순 있지만, 여러 부작용이 뒤따른다

## 교착 상태 회피

교착 상태가 발생하지 않을정도의 양만큼만 자원을 배분하는 방법
-> 교착 상태를 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주함

- 안전 순서열 : 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미

  - 이런 순서대로 프로세스들에 자원을 배분하는 상태를 안전 상태라고 한다

- 안전 상태 : 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
- 불안전 상태 : 교착 상태가 발생할 수 도 있는 상황 -> 안전 순서열이 존재 X

## 교착 상태 검출 후 회복

교착 상태 발생을 인정하고 사후에 조치하는 방식
프로세스들이 자원을 요구할 때마다 할당하고 교착 상태 발생 여부를 주기적으로 검사함, 그리고 검출되면 다음과 같은 방식으로 회복함

### 선점을 통한 회복

교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
-> 다른 프로세스로부터 자원을 강제로 뺴앗고 한 프로세스에 할당하는 방식

### 프로세스 강제 종료를 통한 회복

교착 상태에 놓인 프로세스를 모두 강제 종료 - 한 방에 교착 상태를 해결할 수 있지만 그 만큼 많은 프로세스들이 작업 내역을 잃게 됨
교착 상태가 없어질 때까지 한 프로세스씩 강제 종료 - 작업 내역을 잃는 프로세스를 최대한 줄일 수 있지만 교착 상태가 없어졌는지 여부를 확인하는 과정에서 오버해드를 야기함
