# 파일과 디렉터리

## 파일

하드 디스크나 SSD와 같은 보조기억장치에 저장된 관련 정보의 집합

- 파일은 이름, 실행을 위한 정보, 파일 관련 부가 정보인 속성(메타데이터)으로 구성됨
- 파일 속성: 운영체제마다 조금씩 차이가 있지만 유형, 크기, 보호, 생성 날짜 등이 포함됨
- 파일 유형: 운영체제가 인식하는 파일 종류. 확장자를 통해 운영체제에게 파일 종류가 무엇인지 알려줌
- 파일을 다루는 모든 작업은 운영체제에 의해 이루어지고 파일 연산(ex.파일 생성, 삭제)을 위한 시스템 호출을 제공함

<br/><br/>

## 디렉터리

파일들을 일목요연하게 관리하기 위한 이름 공간

- 윈도우 운영체제에서는 폴더라고 부름
- 1단계 디렉터리: 모든 파일이 하나의 디렉터리 아래에 존재
- 트리 구조 디렉터리: 컴퓨터 용량이 커지고, 저장할 파일이 많아지면서 등장한 여러 계층을 가진 디렉터리 구조. 최상위(루트) 디렉터리 아래에 서브(자식) 디렉터리가 있고, 서브 디렉터리 또한 다른 서브 디렉터리를 가질 수 있음.
- 루트 디렉터리는 주로 슬래시(/)로 표현하고 윈도우에서는 주로 C:₩ 로 표현
- 디렉터리에는 동일한 이름의 파일이 존재할 수 없지만, 서로 다른 디렉터리에는 동일한 이름의 파일이 존재할 수 있음
- 운영체제가 디렉터리 연산(ex.디렉터리 생성, 삭제, 열기, 닫기, 읽기)을 위한 시스템 호출을 제공

### 절대 경로와 상대 경로

- 절대 경로: 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로
  - 윈도우: C:\home\minji
  - 맥, 유닉스, 리눅스: /home/minji
- 상대 경로: 현재 디렉터리부터 시작하는 경로
  - .: 현재 디렉터리
  - ..: 부모 디렉터리

### 디렉터리 엔트리

- 많은 운영체제에서는 디렉터리를 파일의 일종으로 봄
- 디렉터리는 디렉터리 내부에 담겨있는 대상과 관련된 정보를 담고 있고 보통 테이블(표)로 구성됨
- 각 엔트리에 담기는 정보는 파일 시스템 별로 차이가 있지만 공통으로 포함된 대상의 이름과 대상의 보조기억장치 내 위치를 유추할 수 있는 정보가 담김

<br/><br/><br/><br/>

# 파일 시스템

파일과 디렉터리를 보조기억장치에 일목요연하게 저장하고 접근할 수 있게하는 운영체제 내부 프로그램

## 파티셔닝과 포매팅

- 파티셔닝: 파티션을 나누는 작업으로 하드디스크나 SSD 처럼 용량이 큰 저장 장치를 하나 이상의 논리적 단위로 구획하는 것을 의미함. 파티션은 이 때 나누어진 영역 하나를 의미함.
- 포매팅: 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고, 새로운 데이터를 쓸 준비를 하는 작업을 의미함. 이 때 어떤 종류의 파일 시스템을 사용할지 결정
  - 저수준 포매팅: 저장 장치 생성 당시 공장에서 수행되는 물리적인 포매팅
  - 논리적 포매팅: 파일시스템을 생성하는 포매팅
- 파일 시스템엔 여러 종류가 있고, 파티션 마다 다른 파일 시스템 설정이 가능
- 포매팅까지 완료되어 파일 시스템이 설정되었다면 파일과 디렉터리를 생성할 수 있음

<br/><br/>

## 파일 할당 방법

- 모든 내용을 섹터로 관리하기엔 개수가 너무 많고 크기가 너무 작기 때문에 운영체제는 파일과 디렉터리를 블록 단위로 읽고 쓰며, 블록 단위로 파일과 디렉터리를 관리함
- 윈도우에서는 블록 대신 클러스터라는 용어를 사용
- 할당 방법
  - 연속 할당
  - 불연속 할당
    - 연결 할당
    - 색인 할당

### 연속 할당

보조기억장치 내 연속된 블럭에 파일을 할당하는 방식

- 첫 번째 블록 주소와 블록 단위의 길이만 알면 파일에 접근 가능
- 장점: 구현이 단순함
- 단점: 외부 단편화를 야기함

### 연결 할당

각블록의 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당한느 방식

- 파일을 이루는 데이터를 연결 리스트로 관리
- 장점: 외부 단편화 문제 해결
- 단점
  - 반드시 첫 번째 블록부터 접근하여 하나씩 차례대로 읽어야 함 -> 임의 접근 속도가 매우 느림
  - 하드웨어 고장이나 오류로 인해 파일을 이루는 블록에 하나라도 문제가 발생하면 그 블록 이후로는 접근이 불가능

### 색인 할당

모든 블록 주소를 색인 블록이라는 하나의 블록에 모아 관리하는 방식

- 색인 블록 안에 파일을 구성하는 데이터 블록 주소가 있으므로 색인 블록만 알면 데이터에 접근 가능함
- 색인 할당을 사용할 경우 디렉터리 엔트리에 파일 이름과 함께 색인 블록 주소를 명시함
- 장점: 파일 내 임의의 위치에 접근하기 쉬움

<br/><br/>

## 파일 시스템 살펴보기

- 윈도우 운영체제: NT 파일 시스템(NTFS)
- 리눅스 운영체제: ext 파일 시스템

### FAT 파일 시스템

- USB 메모리, SD 카드 등의 저용량 저장 장치에 사용되는 파일 시스템으로 연결 할당의 단점을 보완한 버전
- 블록 안에 다음 블록에 대한 정보를 저장하는 것이 아닌 다음 블록 주소를 한데 모아 파일 할당 테이블(FAT)에 관리함
- 버전에 따라 FAT12, FAT16 등으로 나타내고 숫자는 블록을 표현하는 비트 수를 의미함
- FAT 파일 시스템의 파티션 구성: 예약 영역 - FAT 영역 - 루트 디렉터리 영역 - 데이터 영역
- FAT 은 하드 디스크 파티션의 시작 부분에 있지만 실행하는 도중 FAT가 메모리에 캐시될 수 있음 -> 메모리에 적재된 채 실행되면 기존 연결 할당보다 다음 블록을 찾는 속도가 매우 빨라짐 -> 임의 접근 성능 개선
- 예약 영역: 미래를 대비해서 비워놓은 영역으로 부트 레코드(운영 체제를 로드하고 시스템을 시작하는데 필요한 주요 정보를 저장하는 영역) 저장과 주요 항목 백업을 위해 사용함

### 유닉스 파일 시스템

- 색인 할당 기반의 파일 시스템으로, 색인 블록을 i-node 라고 부름
- i-node 에는 파일 속성 정보와 15개의 블록 주소가 저장될 수 있음
- FAT 파일 시스템에서 파일 속성 정보가 디렉터리 엔트리에 표현된 것과 달리 유닉스 파일 시스템에선 파일 속성 정보가 i-node 에 표현됨
- 유닉스 파일 시슽메의 파티션 구성: 예약 영역 - i-node 영역 - 데이터 영역
- i-node 의 크기가 유한하므로, 15개를 초과하는 큰 파일을 처리하기 위해 12개는 직접 블록, 그 외는 간접 블록을 가리키게 함
  - 직접 블록: 파일 데이터가 저장된 블록 주소가 직접적으로 명시된 블록. 처음 12개에는 직접 블록으로 구성됨
  - 단일 간접 블록: 파일 데이터를 저장한 블록 주소를 저장하는 블록. 12개의 블록 주소로 부족할 경우 13번째 블록은 단일 간접 블록으로 사용
  - 이중 간접 블록: 단일 간접 블록들의 주소를 저장하는 블록. 단일 간접 블록으로도 부족할 때 14번째 블록은 이중 간접 블록으로 사용
  - 삼중 간접 블록: 이중 간접 블록들의 주소를 저장하는 블록. 이중 간접 블록으로도 부족할 때 15번째 블록은 삼중 간접 블록으로 사용함
- 유닉스 파일 시스템 디렉터리 엔트리: i-node 번호 - 파일 이름
- 유닉스 파일 시스템은 루트 디렉터리의 i-node 를 하앙 기억하고 있음

<br/><br/>

## 저널링 파일 시스템

- 파일 시스템을 변경하는 중 전원이 나가거나 컴퓨터가 강제 종료 되어버리는, 시스템 크래시가 발생하면 파일 시스템이 훼손될 수 있음
- 기존엔 부팅 직후 파일 시스템을 검사하고 복구하는 프로그램을 실행시켰으나 파일 시스템 내 모든 블록에 대해 검사를 실행하기 때문에 시간이 매우 오래걸렸음
- 저널링 기법: 작업 로그를 통해 시스템 크래시가 발생했을 때 빠르게 복구하기 위한 방법
  1. 작업 직전의 파티션의 로그 영역에 수행하는 작업(변경 사항)에 대한 로그를 남김
  2. 로그를 남긴 후 작업 수행
  3. 작업이 끝났다면 로그 삭제
- 저널링 파일 시스템 파티션: 예약 영역 - 로그 영역 - i-node 영역 - 데이터 영역
- 로그 영역에 남긴 로그만 검사해도 되므로 빠르게 복구가 가능하며 현대 대부분의 시스템이 이런 저널링 기능을 지원함

<br/><br/>

## 마운트

한 저장 장치의 파일 시스템에서 다른 저장 장치의 파일 시스템에 접근할 수 있도록 파일 시스템을 편입시키는 작업을 의미함

- 유닉스, 리눅스와 같은 운영체제에서 다양한 저장 장치를 연결 시, mount 명령어로 빈번하게 마운트함
